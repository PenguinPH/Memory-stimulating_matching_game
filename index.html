<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    .card {
      perspective: 1000px;
      cursor: pointer;
    }
    
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
    }
    
    .card-back {
      transform: rotateY(180deg);
    }
    
    .card.matched {
      opacity: 0.6;
      pointer-events: none;
    }
    
    @keyframes celebration {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .celebrate {
      animation: celebration 0.5s ease-in-out;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div class="w-full h-full overflow-auto">
   <div class="min-h-full flex flex-col items-center justify-center p-8">
    <div class="w-full max-w-4xl"><!-- Start Screen -->
     <div id="startScreen" class="text-center">
      <h1 id="startTitle" class="text-6xl font-bold mb-4">‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h1>
      <p id="startSubtitle" class="text-2xl mb-12 opacity-90">‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
      <h2 id="difficultyTitle" class="text-3xl font-semibold mb-8">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-3xl mx-auto"><!-- Easy Level --> <button class="difficulty-btn px-8 py-12 rounded-2xl transition-all hover:shadow-xl transform hover:scale-105" data-level="easy">
        <div class="text-6xl mb-4">
         üòä
        </div>
        <div class="text-2xl font-bold mb-2">
         ‡∏á‡πà‡∏≤‡∏¢
        </div>
        <div class="text-lg opacity-80">
         4 ‡∏Ñ‡∏π‡πà (8 ‡πÉ‡∏ö)
        </div>
        <div class="text-sm mt-2 opacity-70">
         2x4 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        </div></button> <!-- Medium Level --> <button class="difficulty-btn px-8 py-12 rounded-2xl transition-all hover:shadow-xl transform hover:scale-105" data-level="medium">
        <div class="text-6xl mb-4">
         ü§î
        </div>
        <div class="text-2xl font-bold mb-2">
         ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
        </div>
        <div class="text-lg opacity-80">
         8 ‡∏Ñ‡∏π‡πà (16 ‡πÉ‡∏ö)
        </div>
        <div class="text-sm mt-2 opacity-70">
         4x4 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        </div></button> <!-- Hard Level --> <button class="difficulty-btn px-8 py-12 rounded-2xl transition-all hover:shadow-xl transform hover:scale-105" data-level="hard">
        <div class="text-6xl mb-4">
         üß†
        </div>
        <div class="text-2xl font-bold mb-2">
         ‡∏¢‡∏≤‡∏Å
        </div>
        <div class="text-lg opacity-80">
         12 ‡∏Ñ‡∏π‡πà (24 ‡πÉ‡∏ö)
        </div>
        <div class="text-sm mt-2 opacity-70">
         4x6 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        </div></button>
      </div>
     </div><!-- Game Screen -->
     <div id="gameScreen" class="hidden"><!-- Header -->
      <div class="text-center mb-8">
       <h1 id="gameTitle" class="text-5xl font-bold mb-3">‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h1>
       <p id="gameSubtitle" class="text-2xl opacity-90">‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
      </div><!-- Stats -->
      <div class="flex justify-center gap-8 mb-6">
       <div class="text-center px-6 py-3 rounded-xl">
        <div id="movesLabel" class="text-xl font-semibold mb-1">
         ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô
        </div>
        <div id="movesCount" class="text-3xl font-bold">
         0
        </div>
       </div>
       <div class="text-center px-6 py-3 rounded-xl">
        <div id="matchesLabel" class="text-xl font-semibold mb-1">
         ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        </div>
        <div id="matchesCount" class="text-3xl font-bold">
         0 / 8
        </div>
       </div>
      </div><!-- Game Board -->
      <div id="gameBoard" class="grid gap-4 mb-6"><!-- Cards will be generated by JavaScript -->
      </div><!-- New Game Button -->
      <div class="text-center"><button id="newGameBtn" class="px-8 py-3 rounded-xl text-xl font-semibold transition-all hover:shadow-lg"> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà </button>
      </div><!-- Win Message -->
      <div id="winMessage" class="text-center mt-6 text-3xl font-bold hidden celebrate">
       ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß! üéâ
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      background_color: "#f5f5dc",
      card_front_color: "#8b7355",
      card_back_color: "#fff8dc",
      text_color: "#3e2723",
      button_color: "#a0826d",
      stats_bg_color: "#e8dcc4",
      font_family: "system-ui",
      font_size: 16,
      game_title: "‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û",
      game_subtitle: "‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
      new_game_button: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà",
      moves_label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô",
      matches_label: "‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
      win_message: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß! üéâ"
    };

    const allEmojis = ['‚≠ê', '‚ù§Ô∏è', 'üåô', '‚òÄÔ∏è', 'üå∏', 'üéµ', 'üè†', 'üöó', '‚úàÔ∏è', '‚öΩ', 'üéÅ', '‚òÇÔ∏è'];
    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let moves = 0;
    let canFlip = true;
    let currentLevel = 'medium';
    let totalPairs = 8;

    const levelConfig = {
      easy: { pairs: 4, cols: 4, rows: 2 },
      medium: { pairs: 8, cols: 4, rows: 4 },
      hard: { pairs: 12, cols: 4, rows: 6 }
    };

    function showStartScreen() {
      document.getElementById('startScreen').classList.remove('hidden');
      document.getElementById('gameScreen').classList.add('hidden');
    }

    function showGameScreen() {
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('gameScreen').classList.remove('hidden');
    }

    function startGame(level) {
      currentLevel = level;
      totalPairs = levelConfig[level].pairs;
      showGameScreen();
      initGame();
    }

    function initGame() {
      const gameBoard = document.getElementById('gameBoard');
      gameBoard.innerHTML = '';
      
      const config = levelConfig[currentLevel];
      const selectedEmojis = allEmojis.slice(0, config.pairs);
      
      // Create pairs and shuffle
      cards = [...selectedEmojis, ...selectedEmojis]
        .sort(() => Math.random() - 0.5)
        .map((emoji, index) => ({ emoji, id: index, matched: false }));
      
      flippedCards = [];
      matchedPairs = 0;
      moves = 0;
      canFlip = true;
      
      // Set grid layout
      gameBoard.style.gridTemplateColumns = `repeat(${config.cols}, 1fr)`;
      
      updateStats();
      document.getElementById('winMessage').classList.add('hidden');
      
      // Create card elements
      cards.forEach((card, index) => {
        const cardElement = createCardElement(card, index);
        gameBoard.appendChild(cardElement);
      });
      
      applyStyles();
    }

    function createCardElement(card, index) {
      const cardDiv = document.createElement('div');
      cardDiv.className = 'card aspect-square';
      cardDiv.dataset.index = index;
      
      cardDiv.innerHTML = `
        <div class="card-inner">
          <div class="card-front">
            <span class="text-3xl">?</span>
          </div>
          <div class="card-back">
            <span class="text-5xl">${card.emoji}</span>
          </div>
        </div>
      `;
      
      cardDiv.addEventListener('click', () => handleCardClick(index));
      return cardDiv;
    }

    function handleCardClick(index) {
      if (!canFlip || flippedCards.length >= 2) return;
      
      const card = cards[index];
      const cardElement = document.querySelector(`[data-index="${index}"]`);
      
      if (card.matched || flippedCards.includes(index)) return;
      
      cardElement.classList.add('flipped');
      flippedCards.push(index);
      
      if (flippedCards.length === 2) {
        moves++;
        updateStats();
        checkMatch();
      }
    }

    function checkMatch() {
      canFlip = false;
      const [index1, index2] = flippedCards;
      const card1 = cards[index1];
      const card2 = cards[index2];
      
      setTimeout(() => {
        if (card1.emoji === card2.emoji) {
          // Match found
          card1.matched = true;
          card2.matched = true;
          document.querySelector(`[data-index="${index1}"]`).classList.add('matched');
          document.querySelector(`[data-index="${index2}"]`).classList.add('matched');
          matchedPairs++;
          updateStats();
          
          if (matchedPairs === totalPairs) {
            setTimeout(() => {
              document.getElementById('winMessage').classList.remove('hidden');
            }, 300);
          }
        } else {
          // No match
          document.querySelector(`[data-index="${index1}"]`).classList.remove('flipped');
          document.querySelector(`[data-index="${index2}"]`).classList.remove('flipped');
        }
        
        flippedCards = [];
        canFlip = true;
      }, 1000);
    }

    function updateStats() {
      document.getElementById('movesCount').textContent = moves;
      document.getElementById('matchesCount').textContent = `${matchedPairs} / ${totalPairs}`;
    }

    function applyStyles() {
      const config = window.elementSdk?.config || defaultConfig;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      
      // Background
      document.body.style.background = config.background_color || defaultConfig.background_color;
      
      // Start screen styling
      document.getElementById('startTitle').style.color = config.text_color || defaultConfig.text_color;
      document.getElementById('startTitle').style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.getElementById('startTitle').style.fontSize = `${baseSize * 2.5}px`;
      
      document.getElementById('startSubtitle').style.color = config.text_color || defaultConfig.text_color;
      document.getElementById('startSubtitle').style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.getElementById('startSubtitle').style.fontSize = `${baseSize * 1.25}px`;
      
      document.getElementById('difficultyTitle').style.color = config.text_color || defaultConfig.text_color;
      document.getElementById('difficultyTitle').style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.getElementById('difficultyTitle').style.fontSize = `${baseSize * 1.5}px`;
      
      // Difficulty buttons
      const diffBtns = document.querySelectorAll('.difficulty-btn');
      diffBtns.forEach(btn => {
        btn.style.background = config.button_color || defaultConfig.button_color;
        btn.style.color = '#ffffff';
        btn.style.fontFamily = `${customFont}, ${baseFontStack}`;
      });
      
      // Text colors
      document.getElementById('gameTitle').style.color = config.text_color || defaultConfig.text_color;
      document.getElementById('gameTitle').style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.getElementById('gameTitle').style.fontSize = `${baseSize * 2}px`;
      
      document.getElementById('gameSubtitle').style.color = config.text_color || defaultConfig.text_color;
      document.getElementById('gameSubtitle').style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.getElementById('gameSubtitle').style.fontSize = `${baseSize * 1.25}px`;
      
      // Stats
      const statDivs = document.querySelectorAll('#movesLabel, #matchesLabel, #movesCount, #matchesCount');
      statDivs.forEach(div => {
        div.style.color = config.text_color || defaultConfig.text_color;
        div.style.fontFamily = `${customFont}, ${baseFontStack}`;
        div.style.background = config.stats_bg_color || defaultConfig.stats_bg_color;
      });
      
      document.getElementById('movesLabel').style.fontSize = `${baseSize * 1.1}px`;
      document.getElementById('matchesLabel').style.fontSize = `${baseSize * 1.1}px`;
      document.getElementById('movesCount').style.fontSize = `${baseSize * 1.5}px`;
      document.getElementById('matchesCount').style.fontSize = `${baseSize * 1.5}px`;
      
      // Cards
      const cardFronts = document.querySelectorAll('.card-front');
      const cardBacks = document.querySelectorAll('.card-back');
      
      cardFronts.forEach(card => {
        card.style.background = config.card_front_color || defaultConfig.card_front_color;
        card.style.color = '#ffffff';
      });
      
      cardBacks.forEach(card => {
        card.style.background = config.card_back_color || defaultConfig.card_back_color;
        card.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
      });
      
      // Button
      const btn = document.getElementById('newGameBtn');
      btn.style.background = config.button_color || defaultConfig.button_color;
      btn.style.color = '#ffffff';
      btn.style.fontFamily = `${customFont}, ${baseFontStack}`;
      btn.style.fontSize = `${baseSize * 1.1}px`;
      
      // Win message
      document.getElementById('winMessage').style.color = config.text_color || defaultConfig.text_color;
      document.getElementById('winMessage').style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.getElementById('winMessage').style.fontSize = `${baseSize * 1.5}px`;
      
      // Update text content
      document.getElementById('startTitle').textContent = config.game_title || defaultConfig.game_title;
      document.getElementById('startSubtitle').textContent = config.game_subtitle || defaultConfig.game_subtitle;
      document.getElementById('gameTitle').textContent = config.game_title || defaultConfig.game_title;
      document.getElementById('gameSubtitle').textContent = config.game_subtitle || defaultConfig.game_subtitle;
      document.getElementById('newGameBtn').textContent = config.new_game_button || defaultConfig.new_game_button;
      document.getElementById('movesLabel').textContent = config.moves_label || defaultConfig.moves_label;
      document.getElementById('matchesLabel').textContent = config.matches_label || defaultConfig.matches_label;
      document.getElementById('winMessage').textContent = config.win_message || defaultConfig.win_message;
    }

    // Event listeners
    document.getElementById('newGameBtn').addEventListener('click', showStartScreen);
    
    // Difficulty button listeners
    document.querySelectorAll('.difficulty-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const level = e.currentTarget.dataset.level;
        startGame(level);
      });
    });

    // Element SDK integration
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          applyStyles();
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.stats_bg_color || defaultConfig.stats_bg_color,
              set: (value) => {
                config.stats_bg_color = value;
                window.elementSdk.setConfig({ stats_bg_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.button_color || defaultConfig.button_color,
              set: (value) => {
                config.button_color = value;
                window.elementSdk.setConfig({ button_color: value });
              }
            },
            {
              get: () => config.card_front_color || defaultConfig.card_front_color,
              set: (value) => {
                config.card_front_color = value;
                window.elementSdk.setConfig({ card_front_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["game_subtitle", config.game_subtitle || defaultConfig.game_subtitle],
          ["new_game_button", config.new_game_button || defaultConfig.new_game_button],
          ["moves_label", config.moves_label || defaultConfig.moves_label],
          ["matches_label", config.matches_label || defaultConfig.matches_label],
          ["win_message", config.win_message || defaultConfig.win_message]
        ])
      });
    }

    // Initialize on load - show start screen with difficulty selection
    applyStyles();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9acd22e9b50c732b',t:'MTc2NTU0MTYxMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
